services:
  web:
    build:
      context: .
      dockerfile: Dockerfile
    working_dir: /app
    # Mount your source code into the container
    volumes:
      - .:/app:delegated # bind-mount source for live editing
      #      # Keep container's node_modules (avoid host overriding it)
      - node_modules:/app/node_modules
    environment:
      # Dev server and file-watching reliability in Docker
      # Ensures webpack/vite see file changes inside a container
      - CHOKIDAR_USEPOLLING=true
      - CHOKIDAR_INTERVAL=300 #milliseconds
      - WATCHPACK_POLLING=true
      # Create React App (CRA) needs this to listen on all interfaces
      - HOST=0.0.0.0
      # (Sometimes needed for CRA HMR over Docker)
      - WDS_SOCKET_PORT=0
    ports:
      - "3000:3000" # host:container; change to 5173 for Vite
    # If you removed CMD from the Dockerfile, uncomment this:
    # command: npm start

volumes:
  node_modules: